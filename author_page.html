{% extends "base.html" %}

{% block title %}
{% if not errors %}
{{ author.name }}
{% else %}
No author
{% endif %} | 
{% endblock %}

{% block page_title %}
{% if not errors %}
{{ author.name }}
  {% ifequal author.key.name user.user_id %}
<div class="page_title_action"><a href="/EditAuthor">[change your name]</a></div>
  {% endifequal %}
{% else %}
Author is none.
{% endif %}
{% endblock %}

{% block content %}
{% spaceless %}

<ul class="story_list">
  {% if author %}
    {% for category in categories %}
      {% if category.name %}
      <h2>
        <div class="view_all_link"><a href="/Author/{{ author.key.name }}/Category/{{ category.slug|title }}">| view category</a></div>
        <a class="category_name" href="/Author/{{ author.key.name }}/Category/{{ category.slug|title }}">{{ category.name|title }}</a>
        {% ifequal author.key.name user.user_id %}<a class="action" href="/DeleteCategory/{{ user.user_id }}/{{ category.slug|title }}">[delete]</a>
        {% endifequal %}
      </h2>  
        {# if the category has a title, display a limited num of stories #}
        {% for story in category.some_stories %}
        <li>
          <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
          {% ifequal author.key.name user.user_id %}
          <a class="action" href="/Edit/{{ story.key.name|title }}">[edit]</a> <a class="action" href="/Delete/{{ story.key.name|title }}">[delete]</a>
          {% endifequal %}
        </li>
        {% endfor %}

      {% else %}
        {% for story in category.stories %}
        <li>
          <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
          {% ifequal author.key.name user.user_id %}
          <a class="action" href="/Edit/{{ story.key.name|title }}">[edit]</a> <a class="action" href="/Delete/{{ story.key.name|title }}">[delete]</a>
          {% endifequal %}
        </li>
        {% endfor %}      
      {% endif %}
    {% endfor %}
    {% if favorites %}
      <h2>
        <div class="view_all_link"><a href="">| view favorites</a></div>
        <a class="favorites_header" href="">Favorite Stories</a>
      </h2>
      
      {% for story in favorites %}
      <li>
        <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
      </li>
      {% endfor %}
    {% endif %}
  {% else %}
    {% if not errors %}
    <p><a href="/Share">Write a story!</a></p>
    {% endif %}
  {% endif %}
</ul>

{% endspaceless %}
{% endblock content %}
