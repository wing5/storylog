{% extends "base.html" %}

{% block title %}
{% if not errors %}
  {% if not author %}
{{ user.nickname }}
  {% else %}
{{ author.name }}
  {% endif %}
{% else %}
No author
{% endif %} | 
{% endblock %}

{% block page_title %}
{% if not errors %}
{{ author.name }}
  {% ifequal author.key.name user.user_id %}
<div class="page_title_action"><a href="/EditAuthor">[change your name]</a></div>
  {% endifequal %}
{% else %}
Author is none
{% endif %}
{% endblock %}

{% block content %}
{% spaceless %}

{% if author %}
<ul class="story_list">
{% block category_list %}
  {% for category in categories %}
    {% if not category.name or categories|length_is:"1" %}
      {# category has no title, display all stories #}
      {% for story in category.stories %}
      <li>
        <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
        {% ifequal author.key.name user.user_id %}
        <a class="action" href="/Edit/{{ story.key.name|title }}">[edit]</a> <a class="action" href="/Delete/{{ story.key.name|title }}">[delete]</a>
        {% endifequal %}
      </li>
      {% endfor %}
    {% else %}{# the category has a title, display a limited num of stories #}
    <h2>
      {% block category_header %}
      <div class="view_all_link"><a href="/Author/{{ author.key.name }}/Category/{{ category.slug|title }}">| view category</a></div>
      <a class="category_name" href="/Author/{{ author.key.name }}/Category/{{ category.slug|title }}">{{ category.name|title }}</a>
      {% endblock %}
      {% ifequal author.key.name user.user_id %}
      <a class="action" href="/DeleteCategory/{{ user.user_id }}/{{ category.slug|title }}">[delete]</a>
      {% endifequal %}
    </h2>  
      {% for story in category.some_stories %}
      <li>
        <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
        {% ifequal author.key.name user.user_id %}
        <a class="action" href="/Edit/{{ story.key.name|title }}">[edit]</a> <a class="action" href="/Delete/{{ story.key.name|title }}">[delete]</a>
        {% endifequal %}
      </li>
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endblock category_list %}
{% block favorites_list %}
  {% if author.favorites %}
    <h2>
      <div class="view_all_link"><a href="/Author/{{ author.key.name }}/Favorites">| view favorites</a></div>
      <a class="favorites_header" href="/Author/{{ author.key.name }}/Favorites">Favorite Stories</a>
    </h2>
    {% for story in author.some_favorite_stories %}
    <li>
      <a class="story_title" href="/{{ story.key.name|title }}">{{ story.title|title }}</a>
    </li>
    {% endfor %}
  {% endif %}
{% endblock %}
{% else %}
  {% if not errors %}
  <p><a href="/Share">Write a story!</a></p>
  {% endif %}
</ul>
{% endif %}

{% endspaceless %}
{% endblock content %}
